<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Control de Manejo de Residuos Sólidos</title>
    <link rel="stylesheet" href="css/estilo_solidos.css"> <!-- Incluimos el CSS externo -->
    
</head>
<body>
    <div id="alerta" class="alerta hidden">
        <span class="alerta-icono">✔️</span>
            Introducción al Manejo de Residuos Sólidos en INVERSIONES LA ESMERALDA 1966 SAS
            <br>
            <br>
            El adecuado manejo de los residuos sólidos es un aspecto fundamental para garantizar la sostenibilidad y el cumplimiento normativo en el sector de la panificación. En INVERSIONES LA ESMERALDA 1966 SAS, la correcta gestión de estos residuos no solo contribuye a la preservación del medio ambiente, sino que también asegura el cumplimiento de la legislación vigente en Colombia, la cual busca mitigar el impacto ambiental y promover prácticas sostenibles.
            <br>
            <br>
            De acuerdo con el Decreto 1076 de 2015, que compila las normativas ambientales en el país, y la Ley 1259 de 2008, que establece sanciones por el mal manejo de los residuos sólidos, las empresas, incluyendo INVERSIONES LA ESMERALDA 1966 SAS, están obligadas a implementar planes de manejo de residuos sólidos (PMIRS). Estos planes incluyen la separación en la fuente, recolección, almacenamiento adecuado, y disposición final, con el fin de minimizar los residuos y promover el reciclaje y la reutilización.
            <br>
            <br>
            Además, INVERSIONES LA ESMERALDA 1966 SAS debe cumplir con las directrices establecidas por la Resolución 668 de 2016, que regula la gestión integral de los residuos peligrosos y no peligrosos, asegurando que los materiales como empaques, restos de alimentos, y otros subproductos generados en el proceso de producción, sean manejados de manera responsable y segura.
    </div>

    <table class="header-table">
        <tr>
            <!-- Celda para el logo -->
            <td rowspan="2" class="logo">
                <img alt="Logo" height="70" src="img/logo pana.png" width="70"/>
            </td>
            <!-- Celda para el título principal -->
            <th id="infoArea1" colspan="9" class="main-title">REGISTRO DE CONTROL DE MANEJO DE RESIDUOS SÓLIDOS</th>
            <!-- Celda para información adicional -->
            <td class="info">Código: ESM2-SGC-FOR-02</td>
        </tr>
        <tr>
            <!-- Segunda fila de título secundario -->
            <td colspan="9" class="sub-title">SISTEMA DE GESTIÓN DE CALIDAD</td>
            <td class="info">
                <div>Versión: 2-2024</div>
                <div>Fecha: 11/03/2024</div>
            </td>
        </tr>
    </table>

    <!-- Tabla de datos -->
    <table class="data-table">
        <thead>
            <tr>
                <th rowspan="2">FECHA</th>
                <th colspan="4">ASPECTOS A EVALUAR (C / NC)</th>
                <th colspan="2">TIPO DE RESIDUO</th>
                <th rowspan="2">RESPONSABLE</th>
                <th rowspan="2">VERIFICADO POR</th>
            </tr>
            <tr>
                <th>Caneca con bolsa y tapa</th>
                <th>Caneca limpia y en buen estado</th>
                <th>Separación adecuada de residuos</th>
                <th>Evacuación correcta</th>
                <th>RESIDUO APROVECHABLES (Kg) Bolsa Blanca</th>
                <th>RESIDUO NO APROVECHABLES (Kg) Bolsa Negra</th>
            </tr>
        </thead>
        <tbody>
            <!-- Aquí se pueden agregar las filas de datos -->
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
            </tr>
            <tr>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
            </tr>
        </tbody>
    </table>

    <!-- Tabla final para observaciones -->
    <table class="footer-table">
        <tr>
            <th>FECHA</th>
            <th id="infoArea" >HALLAZGO</th>
            <th>CORRECCION</th>
            <th>RESPONSABLE</th>
            <th>VERIFICADO POR</th>
        </tr>
        <!-- Filas de observaciones -->
        <tr>
            <td contenteditable="true"></td>
            <td id="h1" contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
        </tr>
        <tr>
            <td contenteditable="true"></td>
            <td id="h2" contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
        </tr>
        
    </table>

    <p class="notes">C: CONFORME  NC: NO CONFORME</p>

    <button onclick="exportToExcel()" class="btn success">
        <img src="img/excel.png" alt="Icono" style="width: 20px; height: 20px; vertical-align: middle;">
        Descargar Exce
    </button>

        <!-- Botón para enviar reporte -->
        <button id="btnEnviarReporte" class="btn2 success2">
            <img src="img/whatsapp2.png" alt="Icono" style="width: 20px; height: 20px; vertical-align: middle;">
            ENVIAR REPORTE
        </button>

    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script>
        function exportToExcel() {
            // Obtiene ambas tablas
            let dataTable = document.querySelector(".data-table");
            let footerTable = document.querySelector(".footer-table");
        
            // Convierte la tabla principal a una hoja de Excel
            let dataSheet = XLSX.utils.table_to_sheet(dataTable);
        
            // Convierte la tabla de observaciones a una hoja de Excel
            let footerSheet = XLSX.utils.table_to_sheet(footerTable);
        
            // Fusiona los datos de ambas tablas en una sola hoja
            let range = XLSX.utils.decode_range(dataSheet['!ref']);
            let footerRange = XLSX.utils.decode_range(footerSheet['!ref']);
            
            // Calcula la posición de inicio para la segunda tabla en la misma hoja
            let startRow = range.e.r + 2; // Agrega dos filas de espacio entre tablas
            let footerStartCell = XLSX.utils.encode_cell({ r: startRow, c: 0 });
            
            // Agrega cada celda de la tabla de observaciones al final de la hoja principal
            Object.keys(footerSheet).forEach(cell => {
                if(cell[0] !== '!') { // Ignora propiedades especiales
                    let newCell = XLSX.utils.encode_cell({
                        r: XLSX.utils.decode_cell(cell).r + startRow,
                        c: XLSX.utils.decode_cell(cell).c
                    });
                    dataSheet[newCell] = footerSheet[cell];
                }
            });
            
            // Actualiza el rango de la hoja después de agregar la segunda tabla
            dataSheet['!ref'] = XLSX.utils.encode_range({
                s: { r: 0, c: 0 }, // Inicio
                e: { r: startRow + footerRange.e.r, c: footerRange.e.c } // Fin
            });
        
            // Crea un libro de trabajo y añade la hoja de Excel fusionada
            let workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, dataSheet, "Control de Residuos");
        
            // Guarda el archivo Excel
            XLSX.writeFile(workbook, "control_manejo_residuos.xlsx");
        }



        document.getElementById("btnEnviarReporte").addEventListener("click", function() {
    // Obtener los campos "infoArea" y "h1"
    let infoArea = document.getElementById("infoArea1").textContent.trim();
    let hallazgo1 = document.getElementById("h1").textContent.trim();
    let hallazgo2 = document.getElementById("h2").textContent.trim(); // Si tienes más hallazgos

    // Verificar si los campos tienen información
    if (!infoArea && !hallazgo1 && !hallazgo2) {
        // Si no hay datos en los campos, mostrar alerta
        alert("No se encontraron aspectos ni hallazgos para enviar.");
        return; // Detener la ejecución si no hay datos
    }

    // Construir el mensaje a enviar
    let mensaje = "*Área a verificar:*\n";
    
    // Verificar si hay información en el campo "infoArea"
    if (infoArea) {
        mensaje += `*Aspecto a verificar:* ${infoArea}\n`;
    }

    // Agregar los hallazgos al mensaje, si existen
    if (hallazgo1) {
        mensaje += `1. *Hallazgo:* ${hallazgo1}\n`;
    }
    if (hallazgo2) {
        mensaje += `2. *Hallazgo:* ${hallazgo2}\n`;
    }

    // Codificar el mensaje para la URL de WhatsApp
    let url = `https://api.whatsapp.com/send?phone=573125352884&text=${encodeURIComponent(mensaje)}`;

    // Abrir la URL de WhatsApp en una nueva pestaña
    window.open(url, '_blank');
});

                // Mostrar la alerta
                document.getElementById('alerta').classList.remove('hidden');

                // Ocultar la alerta al hacer clic en la pantalla
                document.addEventListener('click', function() {
                    document.getElementById('alerta').classList.add('hidden');
                });
                
        </script>
        
</html>
